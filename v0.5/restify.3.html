<!DOCTYPE html>
<html>
<head>
  <meta http-equiv='content-type' value='text/html;charset=utf8'>
  <meta name='generator' value='Ronn/v0.7.3 (http://github.com/rtomayko/ronn/tree/0.7.3)'>
  <title>restify(3) - Getting Started with restify</title>
  <style type='text/css' media='all'>
  /* style: man */
  body#manpage {margin:0}
  .mp {max-width:100ex;padding:0 9ex 1ex 4ex}
  .mp p,.mp pre,.mp ul,.mp ol,.mp dl {margin:0 0 20px 0}
  .mp h2 {margin:10px 0 0 0}
  .mp > p,.mp > pre,.mp > ul,.mp > ol,.mp > dl {margin-left:8ex}
  .mp h3 {margin:0 0 0 4ex}
  .mp dt {margin:0;clear:left}
  .mp dt.flush {float:left;width:8ex}
  .mp dd {margin:0 0 0 9ex}
  .mp h1,.mp h2,.mp h3,.mp h4 {clear:left}
  .mp pre {margin-bottom:20px}
  .mp pre+h2,.mp pre+h3 {margin-top:22px}
  .mp h2+pre,.mp h3+pre {margin-top:5px}
  .mp img {display:block;margin:auto}
  .mp h1.man-title {display:none}
  .mp,.mp code,.mp pre,.mp tt,.mp kbd,.mp samp,.mp h3,.mp h4 {font-family:monospace;font-size:14px;line-height:1.42857142857143}
  .mp h2 {font-size:16px;line-height:1.25}
  .mp h1 {font-size:20px;line-height:2}
  .mp {text-align:justify;background:#fff}
  .mp,.mp code,.mp pre,.mp pre code,.mp tt,.mp kbd,.mp samp {color:#131211}
  .mp h1,.mp h2,.mp h3,.mp h4 {color:#030201}
  .mp u {text-decoration:underline}
  .mp code,.mp strong,.mp b {font-weight:bold;color:#131211}
  .mp em,.mp var {font-style:italic;color:#232221;text-decoration:none}
  .mp a,.mp a:link,.mp a:hover,.mp a code,.mp a pre,.mp a tt,.mp a kbd,.mp a samp {color:#0000ff}
  .mp b.man-ref {font-weight:normal;color:#434241}
  .mp pre {padding:0 4ex}
  .mp pre code {font-weight:normal;color:#434241}
  .mp h2+pre,h3+pre {padding-left:0}
  ol.man-decor,ol.man-decor li {margin:3px 0 10px 0;padding:0;float:left;width:33%;list-style-type:none;text-transform:uppercase;color:#999;letter-spacing:1px}
  ol.man-decor {width:100%}
  ol.man-decor li.tl {text-align:left}
  ol.man-decor li.tc {text-align:center;letter-spacing:4px}
  ol.man-decor li.tr {text-align:right;float:right}
  </style>
  <style type='text/css' media='screen'>
  /* style: screen */
  body {margin:0}
  #man {max-width:88ex;padding:0 2ex 1ex 2ex}
  #man p,#man pre,#man ul,#man ol,#man dl {margin:0 0 20px 0}
  #man h2 {margin:10px 0 0 0}
  #man > p,#man > pre,#man > ul,#man > ol,#man > dl {margin-left:8ex}
  #man h3 {margin:0 0 0 4ex}
  #man dt {margin:0;clear:left}
  #man dt.flush {float:left;width:8ex}
  #man dd {margin:0 0 0 9ex}
  #man h1,#man h2,#man h3,#man h4 {clear:left}
  #man pre {margin-bottom:20px}
  #man pre+h2,#man pre+h3 {margin-top:22px}
  #man h2+pre,#man h3+pre {margin-top:5px}
  #man img {display:block;margin:auto}
  #man h1.man-title {display:none}
  #man,#man code,#man pre,#man tt,#man kbd,#man samp,#man h3,#man h4 {font-family:monospace;font-size:14px;line-height:1.42857142857143}
  #man h2,#man ol.man {font-size:16px;line-height:1.25
  }
  #man h1 {font-size:20px;line-height:2}
  #man {text-align:justify;background:#fff}
  #man,#man code,#man pre,#man pre code,#man tt,#man kbd,#man samp {color:#131211}
  #man h1,#man h2,#man h3,#man h4 {color:#030201}
  #man ol.man,#man ol.man li {color:#636261}
  #man code,#man strong,#man b {font-weight:bold;color:#131211}
  #man em,#man var,#man u {font-style:italic;color:#434241;text-decoration:none}
  #man pre {background:#edeceb;padding:5px 1ex;border-left:1ex solid #ddd}
  #man pre code {font-weight:normal;background:inherit}
  #man ol.man,#man ol.man li {margin:3px 0 10px 0;padding:0;float:left;width:33%;list-style-type:none;text-transform:uppercase;color:#999;letter-spacing:1px}
  #man ol.man {width:100%}
  #man ol.man li.tl {text-align:left}
  #man ol.man li.tc {text-align:center;letter-spacing:4px}
  #man ol.man li.tr {text-align:right;float:right}
  #man div.man-navigation {position:fixed;top:0;left:96ex;height:100%;width:100%;padding:1ex 0 0 2ex;border-left:0.25ex solid #DCDCDC;background-color: #F5F5F5}
  #man div.man-navigation a {display:block;margin-bottom:1.5ex}
  </style>
  <style type='text/css' media='all'>
  /* style: toc */
  .man-navigation {display:block !important;position:fixed;top:0;left:113ex;height:100%;width:100%;padding:48px 0 0 0;border-left:1px solid #dbdbdb;background:#eee}
  .man-navigation a,.man-navigation a:hover,.man-navigation a:link,.man-navigation a:visited {display:block;margin:0;padding:5px 2px 5px 30px;color:#999;text-decoration:none}
  .man-navigation a:hover {color:#111;text-decoration:underline}
  </style>
</head>
<!--
  The following styles are deprecated and will be removed at some point:
  div#man, div#man ol.man, div#man ol.head, div#man ol.man.

  The .man-page, .man-decor, .man-head, .man-foot, .man-title, and
  .man-navigation should be used instead.
-->
<body id='manpage'>
  <div class='mp' id='man'>

  <div class='man-navigation' style='display:none'>
    <a href="#NAME">NAME</a>
    <a href="#SYNOPSIS">SYNOPSIS</a>
    <a href="#DESCRIPTION">DESCRIPTION</a>
    <a href="#INSTALLATION">INSTALLATION</a>
    <a href="#GETTING-STARTED">GETTING STARTED</a>
    <a href="#ROUTING">ROUTING</a>
    <a href="#REQUEST-PARAMETERS">REQUEST PARAMETERS</a>
    <a href="#SENDING-RESPONSE">SENDING RESPONSE</a>
    <a href="#LOGGING">LOGGING</a>
    <a href="#SECURITY-CONSIDERATIONS">SECURITY CONSIDERATIONS</a>
    <a href="#COPYRIGHT-LICENSE">COPYRIGHT/LICENSE</a>
    <a href="#SEE-ALSO">SEE ALSO</a>
  </div>

  <ol class='man-decor man-head man head'>
    <li class='tl'>restify(3)</li>
    <li class='tc'></li>
    <li class='tr'>restify(3)</li>
  </ol>

  <h2 id="NAME">NAME</h2>
<p class="man-name">
  <code>restify</code> - <span class="man-whatis">Getting Started with restify</span>
</p>

<h2 id="SYNOPSIS">SYNOPSIS</h2>

<pre><code>var restify = require('restify');
var server = restify.createServer();

server.get('/my/:name', function(req, res) {
  res.send(200, {
    message: 'Hello ' + req.uriParams.name
  });
});

server.listen(8080);
</code></pre>

<h2 id="DESCRIPTION">DESCRIPTION</h2>

<p>restify is a node.js module built specifically to enable you to build correct
REST web services.  restify is <strong>not</strong> an MVC framework and does not come
bundled with unnecessary functionality for this use case (such as templating).
restify lets you do one thing, which is easily build machine-consumable web
service APIs that correctly implement HTTP.</p>

<p>restify's external API looks very similar to some amalgam of sinatra and
express.  This man page contains basic getting started information, and plenty
of references to more details on the API.</p>

<h2 id="INSTALLATION">INSTALLATION</h2>

<pre><code>npm install restify
</code></pre>

<h2 id="GETTING-STARTED">GETTING STARTED</h2>

<p>To create an instance of the restify HTTP server, simply call the <code>createServer</code>
api on the top-level module.  This method takes an optional <code>options</code> Object, of
the following syntax:</p>

<pre><code>{
  version: '1.2.3',      // The default version  (see restify-versions(7))
  serverName: 'MySite',  // returned in the HTTP 'Server:` header
  maxRequestSize: 8192,  // Any request body larger than this gets a 400
  clockSkew: 300,        // Allow up to N seconds of skew in the Date header
  accept: [
    'application/json',  // Allow these Accept types
    'application/foo'
  ],
  contentHandlers: {     // A hash of custom content-type handlers
    'application/foo': function(body) {
      return JSON.parse(body);
    }
  },
  contentWriters: {      // A hash of custom serializers
    'application/foo': function(obj) {
      return JSON.stringify(obj);
    }
  },
  headers: {             // A hash of customer headers
    'X-Foo': function(res) {
      return 'bar';
    }
  },
  key: &lt;PEM>,            // Together with `cert`, create an SSL server
  cert: &lt;PEM>            // Together with `key`, create an SSL server
}
</code></pre>

<p>Defaults/Details for the paramters above:</p>

<ul>
<li>version:
By default, there is no version handling invoked.  However, if you do specify
this header, then <code>x-api-version: 1.2.3</code> will be returned in all HTTP
responses.  Additionally, clients MUST send an <code>x-api-version</code> header that
satisfies that version.  See  <a href="restify-versions.7.html" class="man-ref">restify-versions<span class="s">(7)</span></a> for more details, as this is
a large feature set.</li>
<li>serverName:
Simple string that is not interpreted and returned in the 'Server:' HTTP
header.  Defaults to <code>node.js</code>.</li>
<li>maxRequestSize:
Caps the amount of data a client can send to your HTTP server, in bytes.
Defaults to 8192 (8k).</li>
<li>clockSkew:
If the client sends a 'Date' header, it is checked to be within <code>clockSkew</code>
seconds, in either direction. Defaults to 300s (5m).</li>
<li>accept:
An array of Acceptable content types this server can process. Defaults to
<code>application/json</code>.  Not really useful as of yet.</li>
<li>contentHandlers:
By default, restify supports (and doesn't let you override) clients sending
content in <code>application/json</code>, <code>application/x-www-form-urlencoded</code> and
<code>multipart/form-data</code>.  If you want your clients to be able to send content
in a custom format, you can specify it in this option; keys are (lowercase)
MIME type, value is a function that takes a (UTF-8 string) body, and returns
an object of k/v pairs that get merged into <code>request.params</code>.  Note that
this is only for parsing, not for using <code>res.send</code>.</li>
<li>contentWriters:
By default, restify supports (and doesn't let you override) servers sending
content in <code>application/json</code>, <code>application/x-www-form-urlencoded</code>. If you
want to use <code>res.send</code> with custom content types, you will need to add a
custom writer to this object.  <em>You must additionally set the</em> <code>accept</code>
<em>array to allow it!</em>.  Using this dictionary, you can then use the
<code>res.send</code> naturally with content-types not built-in to restify.</li>
<li>headers:
An object of global headers that are sent back on all requests. Restify
automatically sets the list below.  If you don't set those particular keys,
restify fills in default functions; if you do set them, you can fully override
restify's defaults. Note that like contentWriters, this is an object with a
string key as the header name, and the value is a function of the form
f(response) which must return a string.  Defaults:

<ul>
<li>X-Api-Version (if versioned)</li>
<li>X-Request-Id</li>
<li>X-Response-Time</li>
<li>Content-(Length|Type|MD5)</li>
<li>Access-Control-Allow-(Origin|Methods|Headers)</li>
<li>Access-Control-Expose-Headers</li>
</ul>
</li>
</ul>


<h2 id="ROUTING">ROUTING</h2>

<p>Routing is similar to, but different than, express.  Defining a route still
looks like a <code>method</code> name tacked onto the server object, but you can (1)
pass in versions (so you can define a versioned route), (2) you can pass in
whatever combination of functions you see fit, with the exception that if
<em>both the first and last</em> handlers are an array of functions, they are treated
as <code>pre</code> and <code>post</code> interceptors.  This has the following semnatics:</p>

<ul>
<li><code>pre[0]</code> is guaranteed to be called.  If you do not call <code>response.send</code> or
<code>response.sendError</code> in your <code>pre</code> chain, and your pre functions all call
<code>next()</code>, your <code>main</code> chain will get invoked. If your pre chain calls
<code>response.send</code> or <code>response.sendError</code>, your <code>main</code> chain will be skipped,
and <code>post[0]</code> will be invoked next (assuming you are still calling <code>next()</code>).</li>
<li>Once in your <code>main</code> chain, if you call <code>response.sendError</code>, restify will
stop processing your <code>main</code> handlers, and skip to <code>post</code>.  Calling
<code>response.send</code> does not have this effect, as you are expected to call
<code>response.send</code> as part of a "normal" request.</li>
<li>Once your <code>post</code> chain is invoked, restify stops playing with ordering.</li>
</ul>


<p>Note that for this to work as described, you <em>still have to call next()</em>
in your functions!</p>

<p>Also note that if you're not using an array of functions for the first and last
handlers, restify does not perform the logic above.  It instead falls back to
what express does, and it's up to you to manage your call chain.</p>

<p>As to URL definitions, note that they can be either parameterized string URLs,
(e.g., <code>/:user/stuff/:id</code>) or a <code>RegExp</code>.  In either case, the parameters are
available to your handler functions as <code>request.uriParams</code>.  In the non-regex
case, they're as you named them (minus the ':', of course).  In the <code>RegExp</code>
case, they're available in the array <code>RegExp.exec()</code> returns.</p>

<p>As some examples:</p>

<pre><code>server.head('/foo/:id', [pre1, pre2], handler, [post1]);
server.get('/foo/:id', [pre1, pre2], handler, [post1]);
server.post('/foo', [pre1, pre2], handler, [post1]);
server.put('/foo/:id', [pre1, pre2], handler1, handler2, [post1]);
server.del('/foo/:id', handler1, handler2, handler3);
server.get(/^\/media\/img\/*/, function(req, res, next) {...});
</code></pre>

<p>All functions passed in are expected to be of the form:</p>

<pre><code>function(request, response, next);
</code></pre>

<p>Lastly, you can version your routes, as such:</p>

<pre><code>server.get('1.2.3', '/:user/foo/:id', [pre], [handlers], [post]);
server.get('1.2.2', '/:user/foo/:id', myLegacyHandler);
</code></pre>

<p>Again, see <a href="restify-versions.7.html" class="man-ref">restify-versions<span class="s">(7)</span></a> to understand how versioning works.</p>

<h2 id="REQUEST-PARAMETERS">REQUEST PARAMETERS</h2>

<p>restify supports API parameters in form-urlencoded content and application/json
bodies.  All parameters are placed on the <code>request.parameters</code> object.  For
example, a request like:</p>

<pre><code>server.post('/foo/:id', function(req, res, next) {});

POST /foo/123?param1=dog&amp;param2=cat
Host: example.com
Content-Type: application/x-www-form-urlencoded

param3=bird&amp;param4=turtle
</code></pre>

<p>Would result in a request object like:</p>

<pre><code>{
  uriParams: {
    id: '123'
  },
  params: {
    param1: 'dog',
    param2: 'cat',
    param3: 'bird',
    param4: 'turtle'
  }
}
</code></pre>

<p>Note that restify supports form-urlencoded parameter parsing, as well as
application/json parsing.  Any parameters are merged with query string
parameters.</p>

<p>For more details on the request object, see <code>npm help restify-request</code>.</p>

<h2 id="SENDING-RESPONSE">SENDING RESPONSE</h2>

<p>Responses are sent by your handler using either the <code>send</code> or <code>sendError</code>
api.</p>

<p>The <code>send</code> method can be invoked in one of two forms:</p>

<pre><code>response.send(code, body, headers);
response.send({
  code: 200,
  body: {
    message: 'Hello World'
  }
  headers: {
    'x-foo': 'bar'
  }
});
</code></pre>

<p>The first form being more common, the latter form being preferable for
advanced use cases.  In the first form, code is a <code>Number</code>, body is
a JS <code>Object</code>, and headers is an optional JS <code>Object</code>.</p>

<p>For more details on the respose object, see <code>npm help restify-response</code>.</p>

<h2 id="LOGGING">LOGGING</h2>

<p>restify ships with a minimal interpretation of the log4j logger.  You are
not required to use it in any way.  You can tune the restify logging level
with <code>restify.log.level(restify.LogLevel.&lt;Level>)</code>, where <var>Level</var> is one
of:</p>

<ul>
<li>Fatal</li>
<li>Error</li>
<li>Warn</li>
<li>Info</li>
<li>Debug</li>
<li>Trace</li>
</ul>


<p>The default level is Info.  To get verbose internal logging from restify, set
the level to Trace. All messages from these apis go to stderr.</p>

<p>Note that for the handful of cases where restify doesn't invoke your handlers,
(e.g., 404, 405, 406), restify will output a w3c-compliant message to stdout.</p>

<p>You can redirect stdout/stderr by passing a <code>WriteableStream</code> to
<code>log.stdout(stream)</code> and <code>log.stderr(stream)</code>, respectively.</p>

<p>For more details on logging, see <code>npm help restify-log</code>.</p>

<h2 id="SECURITY-CONSIDERATIONS">SECURITY CONSIDERATIONS</h2>

<p>restify does not provide you any built-in authentication or authorization.  It
is typical that you will need to implement 2 <code>pre</code> filters to handle these.
You should additionally consider always adding an audit <code>post</code> filter on all
requests.</p>

<h2 id="COPYRIGHT-LICENSE">COPYRIGHT/LICENSE</h2>

<p>Copyright 2011 Mark Cavage <a href="&#109;&#97;&#105;&#x6c;&#116;&#x6f;&#x3a;&#x6d;&#99;&#x61;&#x76;&#97;&#x67;&#x65;&#64;&#103;&#109;&#97;&#x69;&#x6c;&#46;&#x63;&#x6f;&#x6d;" data-bare-link="true">&#x6d;&#x63;&#97;&#x76;&#97;&#x67;&#x65;&#64;&#103;&#x6d;&#97;&#105;&#108;&#x2e;&#x63;&#111;&#109;</a></p>

<p>This software is licensed under the MIT License.</p>

<h2 id="SEE-ALSO">SEE ALSO</h2>

<p><a href="restify-request.7.html" class="man-ref">restify-request<span class="s">(7)</span></a>, <a href="restify-response.7.html" class="man-ref">restify-response<span class="s">(7)</span></a>, <a href="restify-routes.7.html" class="man-ref">restify-routes<span class="s">(7)</span></a>, <a href="restify-versions.7.html" class="man-ref">restify-versions<span class="s">(7)</span></a>,
<a href="restify-log.7.html" class="man-ref">restify-log<span class="s">(7)</span></a>, <a href="restify-client.7.html" class="man-ref">restify-client<span class="s">(7)</span></a>, <a href="restify-throttle.7.html" class="man-ref">restify-throttle<span class="s">(7)</span></a></p>


  <ol class='man-decor man-foot man foot'>
    <li class='tl'></li>
    <li class='tc'>July 2011</li>
    <li class='tr'>restify(3)</li>
  </ol>

  </div>
</body>
</html>
