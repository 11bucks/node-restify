<!DOCTYPE html>
<html>
<head>
  <meta http-equiv='content-type' value='text/html;charset=utf8'>
  <meta name='generator' value='Ronn/v0.7.3 (http://github.com/rtomayko/ronn/tree/0.7.3)'>
  <title>restify-response(7) - The Response Object</title>
  <style type='text/css' media='all'>
  /* style: man */
  body#manpage {margin:0}
  .mp {max-width:100ex;padding:0 9ex 1ex 4ex}
  .mp p,.mp pre,.mp ul,.mp ol,.mp dl {margin:0 0 20px 0}
  .mp h2 {margin:10px 0 0 0}
  .mp > p,.mp > pre,.mp > ul,.mp > ol,.mp > dl {margin-left:8ex}
  .mp h3 {margin:0 0 0 4ex}
  .mp dt {margin:0;clear:left}
  .mp dt.flush {float:left;width:8ex}
  .mp dd {margin:0 0 0 9ex}
  .mp h1,.mp h2,.mp h3,.mp h4 {clear:left}
  .mp pre {margin-bottom:20px}
  .mp pre+h2,.mp pre+h3 {margin-top:22px}
  .mp h2+pre,.mp h3+pre {margin-top:5px}
  .mp img {display:block;margin:auto}
  .mp h1.man-title {display:none}
  .mp,.mp code,.mp pre,.mp tt,.mp kbd,.mp samp,.mp h3,.mp h4 {font-family:monospace;font-size:14px;line-height:1.42857142857143}
  .mp h2 {font-size:16px;line-height:1.25}
  .mp h1 {font-size:20px;line-height:2}
  .mp {text-align:justify;background:#fff}
  .mp,.mp code,.mp pre,.mp pre code,.mp tt,.mp kbd,.mp samp {color:#131211}
  .mp h1,.mp h2,.mp h3,.mp h4 {color:#030201}
  .mp u {text-decoration:underline}
  .mp code,.mp strong,.mp b {font-weight:bold;color:#131211}
  .mp em,.mp var {font-style:italic;color:#232221;text-decoration:none}
  .mp a,.mp a:link,.mp a:hover,.mp a code,.mp a pre,.mp a tt,.mp a kbd,.mp a samp {color:#0000ff}
  .mp b.man-ref {font-weight:normal;color:#434241}
  .mp pre {padding:0 4ex}
  .mp pre code {font-weight:normal;color:#434241}
  .mp h2+pre,h3+pre {padding-left:0}
  ol.man-decor,ol.man-decor li {margin:3px 0 10px 0;padding:0;float:left;width:33%;list-style-type:none;text-transform:uppercase;color:#999;letter-spacing:1px}
  ol.man-decor {width:100%}
  ol.man-decor li.tl {text-align:left}
  ol.man-decor li.tc {text-align:center;letter-spacing:4px}
  ol.man-decor li.tr {text-align:right;float:right}
  </style>
  <style type='text/css' media='screen'>
  /* style: screen */
  body {margin:0}
  #man {max-width:88ex;padding:0 2ex 1ex 2ex}
  #man p,#man pre,#man ul,#man ol,#man dl {margin:0 0 20px 0}
  #man h2 {margin:10px 0 0 0}
  #man > p,#man > pre,#man > ul,#man > ol,#man > dl {margin-left:8ex}
  #man h3 {margin:0 0 0 4ex}
  #man dt {margin:0;clear:left}
  #man dt.flush {float:left;width:8ex}
  #man dd {margin:0 0 0 9ex}
  #man h1,#man h2,#man h3,#man h4 {clear:left}
  #man pre {margin-bottom:20px}
  #man pre+h2,#man pre+h3 {margin-top:22px}
  #man h2+pre,#man h3+pre {margin-top:5px}
  #man img {display:block;margin:auto}
  #man h1.man-title {display:none}
  #man,#man code,#man pre,#man tt,#man kbd,#man samp,#man h3,#man h4 {font-family:monospace;font-size:14px;line-height:1.42857142857143}
  #man h2,#man ol.man {font-size:16px;line-height:1.25
  }
  #man h1 {font-size:20px;line-height:2}
  #man {text-align:justify;background:#fff}
  #man,#man code,#man pre,#man pre code,#man tt,#man kbd,#man samp {color:#131211}
  #man h1,#man h2,#man h3,#man h4 {color:#030201}
  #man ol.man,#man ol.man li {color:#636261}
  #man code,#man strong,#man b {font-weight:bold;color:#131211}
  #man em,#man var,#man u {font-style:italic;color:#434241;text-decoration:none}
  #man pre {background:#edeceb;padding:5px 1ex;border-left:1ex solid #ddd}
  #man pre code {font-weight:normal;background:inherit}
  #man ol.man,#man ol.man li {margin:3px 0 10px 0;padding:0;float:left;width:33%;list-style-type:none;text-transform:uppercase;color:#999;letter-spacing:1px}
  #man ol.man {width:100%}
  #man ol.man li.tl {text-align:left}
  #man ol.man li.tc {text-align:center;letter-spacing:4px}
  #man ol.man li.tr {text-align:right;float:right}
  #man div.man-navigation {position:fixed;top:0;left:96ex;height:100%;width:100%;padding:1ex 0 0 2ex;border-left:0.25ex solid #DCDCDC;background-color: #F5F5F5}
  #man div.man-navigation a {display:block;margin-bottom:1.5ex}
  </style>
  <style type='text/css' media='all'>
  /* style: toc */
  .man-navigation {display:block !important;position:fixed;top:0;left:113ex;height:100%;width:100%;padding:48px 0 0 0;border-left:1px solid #dbdbdb;background:#eee}
  .man-navigation a,.man-navigation a:hover,.man-navigation a:link,.man-navigation a:visited {display:block;margin:0;padding:5px 2px 5px 30px;color:#999;text-decoration:none}
  .man-navigation a:hover {color:#111;text-decoration:underline}
  </style>
</head>
<!--
  The following styles are deprecated and will be removed at some point:
  div#man, div#man ol.man, div#man ol.head, div#man ol.man.

  The .man-page, .man-decor, .man-head, .man-foot, .man-title, and
  .man-navigation should be used instead.
-->
<body id='manpage'>
  <div class='mp' id='man'>

  <div class='man-navigation' style='display:none'>
    <a href="#NAME">NAME</a>
    <a href="#SYNOPSIS">SYNOPSIS</a>
    <a href="#DESCRIPTION">DESCRIPTION</a>
    <a href="#SEND">SEND</a>
    <a href="#ERRORS">ERRORS</a>
    <a href="#SECURITY-CONSIDERATIONS">SECURITY CONSIDERATIONS</a>
    <a href="#COPYRIGHT-LICENSE">COPYRIGHT/LICENSE</a>
    <a href="#SEE-ALSO">SEE ALSO</a>
  </div>

  <ol class='man-decor man-head man head'>
    <li class='tl'>restify-response(7)</li>
    <li class='tc'></li>
    <li class='tr'>restify-response(7)</li>
  </ol>

  <h2 id="NAME">NAME</h2>
<p class="man-name">
  <code>restify-response</code> - <span class="man-whatis">The Response Object</span>
</p>

<h2 id="SYNOPSIS">SYNOPSIS</h2>

<pre><code>response: {
  accept: 'application/json',
  requestId: uuid(),
  send: function(options),
  sendError: function(restifyError),
  sentError: boolean,
  startTime: new Date().getTime(),
}
</code></pre>

<h2 id="DESCRIPTION">DESCRIPTION</h2>

<p>The restify response object is simply a set of extensions over the standard
node.js http response object.</p>

<p>The additional parameters placed on the request object are:</p>

<dl>
<dt class="flush">accept</dt><dd>Contains a parsed out version of the 'Accept' header sent from the client, for
one of restify's supported formats.  For example, if the client sends */*,
like curl does, accept will be application/json.</dd>
<dt>requestId</dt><dd>Is a random uuid set to the same value as on the request object.  It is
returned to the client in the <code>x-request-id</code> header. You should log this.</dd>
<dt class="flush">send</dt><dd><code>send</code> is the main extension to the request object, as it wraps up the node.js
writeHead/write/end paradigm.  This method exists for you to really pass in
a JS object, and have that object formatted in a type that restify can
serialize, and matches what the client sent in the Accept header.  See
<a href="#SEND" title="SEND" data-bare-link="true">SEND</a> for more information.</dd>
<dt>sendError</dt><dd>A wrapper method over <code>send</code> that takes a restify <code>error</code> object, as returned
from <code>restify.newError</code>.  See <a href="#ERRORS" title="ERRORS" data-bare-link="true">ERRORS</a> for more information.</dd>
<dt>sentError</dt><dd>A boolean that is set automatically by <code>sendError</code>.  You can use this in
post filters for logging, etc.</dd>
<dt>startTime</dt><dd>The time this request arrived at the server.  Note that this timestamp is when
node.js gives us the request object; so before the body is read, but after the
headers are. It's in milliseconds since epoch.</dd>
</dl>


<h2 id="SEND">SEND</h2>

<p>As noted in the getting started manual, there are two forms of the <code>send</code>
function:</p>

<pre><code>send(code, object, headers);
send(options);
</code></pre>

<p>Where <code>send(code, object, headers)</code> takes a Number (HTTP status code), Object
(the JS object you want to send back), and optional Object of headers.  If you
provide the headers object, it is merged in with the standard headers that
restify fills in for you.  Those headers are:</p>

<ul>
<li>Access-Control-Allow-Origin: *</li>
<li>Access-Control-Allow-Methods: [list of methods set on this uri]</li>
<li>Connection: Close</li>
<li>Content-Length</li>
<li>Content-Type</li>
<li>Content-MD5</li>
<li>Date (RFC 1123 format, in UTC)</li>
<li>Server</li>
<li>X-Request-Id</li>
<li>X-Response-Time (milliseconds)</li>
<li>X-Api-Version (if set on createServer)</li>
</ul>


<p>The <code>send(options)</code> form has the following parameters:</p>

<pre><code>send({
  code: 200,
  headers: {},
  body: {},
  noClose: boolean,
  noEnd: boolean,
  noContentMD5: boolean
});
</code></pre>

<p>This method is used if you want to send back content that restify really doesn't
know what to do with, but you still want to pick up the standard headers (like
request-id, date, etc.).  You do this with the <code>noClose</code> and <code>noEnd</code> options. In
general, if you want to send back something else to clients, you probably want
to invoke <code>send</code> as such:</p>

<pre><code>response.send({
  code: 200,
  headers: {
    'Content-Type': 'text/html',
    'Trailer': 'Content-MD5',
  },
  noEnd: true
};

var hash = crypto.createHash('md5');
...
response.write(data);
hash.update(data);
...
res.addTrailers({'Content-MD5': hash.digest('base64')});
res.end();
</code></pre>

<h2 id="ERRORS">ERRORS</h2>

<p>The response object also has a <code>sendError</code> object that is helpful for
marshalling back 'standard' error messages to clients. Standard here means
consistent, not some actual RFC (there is none).  This is particularly
useful, as it is often the case that an HTTP status code alone is not sufficient
for a client to switch on.  Additionally, restify uses this error method
internally, so you are advised to use it so that your errors fit the same
spec.  The error object restify works with is a standard JS <code>Error</code> object
that has the following fields:</p>

<pre><code>{
  name: 'HttpError',                 // Standard Error field
  httpCode: &lt;HttpStatusCode>,        // Number
  restCode: 'StringInThisFormat',    // String client can switch on
  message: 'Human readable string',  // Whatever you want
  error: Error,                      // An Error 'cause'
  details: {                         // Whatever you want
    ...
  }
}
</code></pre>

<p>You can create one of these with <code>restify.newError</code> as such:</p>

<pre><code>response.sendError(restify.newError({
  httpCode: 409,
  restCode: 'YouAreABadClient',
  message: 'Stop sending me bad stuff',
  details: {
    foo: 'bar',
  }
}));
</code></pre>

<p>HttpCodes are defined on <code>restify.HttpCodes</code>, and there are some standard
REST code strings on <code>restify.RestCodes</code>.  RestCodes has the following:</p>

<ul>
<li>BadRequest: 'BadRequest'</li>
<li>InternalError: 'InternalError'</li>
<li>InvalidArgument: 'InvalidArgument'</li>
<li>InvalidCredentials: 'InvalidCredentials'</li>
<li>InvalidHeader: 'InvalidHeader'</li>
<li>InvalidVersion: 'InvalidVersion'</li>
<li>MissingParameter: 'MissingParameter'</li>
<li>NotAuthorized: 'NotAuthorized'</li>
<li>RequestThrottled: 'RequestThrottled'</li>
<li>RequestTooLarge: 'RequestTooLarge'</li>
<li>ResourceMoved: 'ResourceMoved'</li>
<li>ResourceNotFound: 'ResourceNotFound'</li>
<li>RetriesExceeded: 'RetriesExceeded'</li>
<li>UnknownError: 'UnknownError'</li>
</ul>


<p>If you don't set <code>restCode</code>, restify sets it to <em>UnknownError</em>.  If you don't
set <code>message</code>, restify sets it to <em>Unknown error occured.</em>.  Details and error
are not required, and are not set if not present.</p>

<h2 id="SECURITY-CONSIDERATIONS">SECURITY CONSIDERATIONS</h2>

<p>Don't send back JS <code>Error</code> objects on the <code>sendError</code>  in production usage.
That will have your stack traces, etc.  Bad news.</p>

<h2 id="COPYRIGHT-LICENSE">COPYRIGHT/LICENSE</h2>

<p>Copyright 2011 Mark Cavage <a href="&#x6d;&#97;&#105;&#108;&#x74;&#111;&#58;&#x6d;&#99;&#x61;&#x76;&#97;&#x67;&#101;&#64;&#103;&#x6d;&#x61;&#105;&#x6c;&#46;&#x63;&#x6f;&#109;" data-bare-link="true">&#109;&#99;&#97;&#118;&#97;&#103;&#x65;&#x40;&#103;&#109;&#97;&#x69;&#108;&#46;&#99;&#111;&#x6d;</a></p>

<p>This software is licensed under the MIT License.</p>

<h2 id="SEE-ALSO">SEE ALSO</h2>

<p><a href="restify.3.html" class="man-ref">restify<span class="s">(3)</span></a>, <a href="restify-request.7.html" class="man-ref">restify-request<span class="s">(7)</span></a></p>


  <ol class='man-decor man-foot man foot'>
    <li class='tl'></li>
    <li class='tc'>June 2011</li>
    <li class='tr'>restify-response(7)</li>
  </ol>

  </div>
</body>
</html>
